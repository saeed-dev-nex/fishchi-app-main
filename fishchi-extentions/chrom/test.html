<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ØªØ³Øª Ø§Ú©Ø³ØªÙ†Ø´Ù† ÙÛŒØ´Ú†ÛŒ</title>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }
      .test-section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .test-section h2 {
        color: #667eea;
        margin-bottom: 15px;
      }
      button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        margin: 5px;
      }
      button:hover {
        opacity: 0.9;
      }
      .result {
        margin-top: 15px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 6px;
        border-left: 4px solid #667eea;
      }
      .error {
        border-left-color: #dc3545;
        background: #f8d7da;
      }
      .success {
        border-left-color: #28a745;
        background: #d4edda;
      }
      input {
        width: 100%;
        padding: 10px;
        margin: 5px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ§ª ØªØ³Øª Ø§Ú©Ø³ØªÙ†Ø´Ù† ÙÛŒØ´Ú†ÛŒ</h1>

      <div
        class="test-section"
        style="background: #fff3cd; border-color: #ffeaa7"
      >
        <h2>âš ï¸ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡</h2>
        <p><strong>Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø¨Ø§ÛŒØ¯ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø§Ú©Ø³ØªÙ†Ø´Ù† Ø§Ø¬Ø±Ø§ Ø´ÙˆØ¯:</strong></p>
        <ol>
          <li>Ø§Ú©Ø³ØªÙ†Ø´Ù† Ø±Ø§ Ø¯Ø± Developer Mode Ù†ØµØ¨ Ú©Ù†ÛŒØ¯</li>
          <li>Ø±ÙˆÛŒ Ø¢ÛŒÚ©ÙˆÙ† Ø§Ú©Ø³ØªÙ†Ø´Ù† Ú©Ù„ÛŒÚ© Ø±Ø§Ø³Øª Ú©Ù†ÛŒØ¯</li>
          <li>"Inspect popup" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</li>
          <li>Ø¯Ø± Console Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯:</li>
        </ol>
        <code
          style="
            background: #f8f9fa;
            padding: 10px;
            display: block;
            margin: 10px 0;
          "
        >
          chrome.tabs.create({url: chrome.runtime.getURL('test.html')})
        </code>
        <p><strong>ÛŒØ§ Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø§Ø² popup Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯:</strong></p>
        <p>Ø±ÙˆÛŒ Ø¢ÛŒÚ©ÙˆÙ† Ø§Ú©Ø³ØªÙ†Ø´Ù† Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ Ùˆ Ø§Ø² Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</p>
      </div>

      <div class="test-section">
        <h2>1. ØªØ³Øª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</h2>
        <input
          type="email"
          id="testEmail"
          placeholder="Ø§ÛŒÙ…ÛŒÙ„"
          value="test@example.com"
        />
        <input
          type="password"
          id="testPassword"
          placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±"
          value="password123"
        />
        <button onclick="testLogin()">ØªØ³Øª ÙˆØ±ÙˆØ¯</button>
        <button onclick="testLogout()">ØªØ³Øª Ø®Ø±ÙˆØ¬</button>
        <button onclick="testAuthStatus()">Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</button>
        <div id="authResult" class="result" style="display: none"></div>
      </div>

      <div class="test-section">
        <h2>2. ØªØ³Øª Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§</h2>
        <button onclick="testGetProjects()">Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§</button>
        <div id="projectsResult" class="result" style="display: none"></div>
      </div>

      <div class="test-section">
        <h2>3. ØªØ³Øª Ø§ÛŒØ¬Ø§Ø¯ Ù…Ù†Ø¨Ø¹</h2>
        <button onclick="testCreateSource()">Ø§ÛŒØ¬Ø§Ø¯ Ù…Ù†Ø¨Ø¹ ØªØ³Øª</button>
        <div id="sourceResult" class="result" style="display: none"></div>
      </div>

      <div class="test-section">
        <h2>4. ØªØ³Øª Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø² ØµÙØ­Ù‡</h2>
        <p>Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø§ÛŒÙ† Ø¨Ø®Ø´ØŒ Ø¨Ù‡ ÛŒÚ©ÛŒ Ø§Ø² Ø³Ø§ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø¨Ø±ÙˆÛŒØ¯:</p>
        <ul>
          <li>
            <a href="https://www.sid.ir/paper/1394147/fa" target="_blank"
              >SID.ir</a
            >
          </li>
          <li>
            <a href="https://civilica.com/doc/2396591/" target="_blank"
              >Civilica.com</a
            >
          </li>
          <li>
            <a
              href="https://www.noormags.ir/view/fa/articlepage/446775"
              target="_blank"
              >Noormags.ir</a
            >
          </li>
        </ul>
        <p>Ø³Ù¾Ø³ Ø±ÙˆÛŒ Ø¢ÛŒÚ©ÙˆÙ† Ø§Ú©Ø³ØªÙ†Ø´Ù† Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.</p>
      </div>

      <div class="test-section">
        <h2>5. Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…</h2>
        <button onclick="clearLogs()">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§</button>
        <div
          id="logs"
          class="result"
          style="max-height: 200px; overflow-y: auto"
        ></div>
      </div>
    </div>

    <script>
      // Check if extension context is available
      function checkExtensionContext() {
        if (typeof chrome === 'undefined' || !chrome.runtime) {
          showResult(
            'authResult',
            {
              error:
                'Ø§Ú©Ø³ØªÙ†Ø´Ù† Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø±Ø§ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø§Ú©Ø³ØªÙ†Ø´Ù† Ø¨Ø§Ø² Ú©Ù†ÛŒØ¯.',
              instructions:
                'Ø¨Ø±Ø§ÛŒ ØªØ³Øª: 1) Ø§Ú©Ø³ØªÙ†Ø´Ù† Ø±Ø§ Ù†ØµØ¨ Ú©Ù†ÛŒØ¯ 2) Ø±ÙˆÛŒ Ø¢ÛŒÚ©ÙˆÙ† Ø§Ú©Ø³ØªÙ†Ø´Ù† Ú©Ù„ÛŒÚ© Ø±Ø§Ø³Øª Ú©Ù†ÛŒØ¯ 3) "Inspect popup" Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ 4) Ø¯Ø± Console Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯',
            },
            false
          );
          return false;
        }
        return true;
      }

      // Test functions
      async function testLogin() {
        if (!checkExtensionContext()) return;

        const email = document.getElementById('testEmail').value;
        const password = document.getElementById('testPassword').value;

        try {
          const response = await chrome.runtime.sendMessage({
            action: 'login',
            email: email,
            password: password,
          });

          showResult('authResult', response, response.success);
        } catch (error) {
          showResult('authResult', { error: error.message }, false);
        }
      }

      async function testLogout() {
        if (!checkExtensionContext()) return;

        try {
          const response = await chrome.runtime.sendMessage({
            action: 'logout',
          });

          showResult('authResult', response, response.success);
        } catch (error) {
          showResult('authResult', { error: error.message }, false);
        }
      }

      async function testAuthStatus() {
        if (!checkExtensionContext()) return;

        try {
          const response = await chrome.runtime.sendMessage({
            action: 'checkAuth',
          });

          showResult('authResult', response, response.authenticated);
        } catch (error) {
          showResult('authResult', { error: error.message }, false);
        }
      }

      async function testGetProjects() {
        if (!checkExtensionContext()) return;

        try {
          const response = await chrome.runtime.sendMessage({
            action: 'getProjects',
          });

          showResult('projectsResult', response, response.success);
        } catch (error) {
          showResult('projectsResult', { error: error.message }, false);
        }
      }

      async function testCreateSource() {
        if (!checkExtensionContext()) return;

        const testSource = {
          title: 'Ù…Ù†Ø¨Ø¹ ØªØ³Øª Ø§Ú©Ø³ØªÙ†Ø´Ù†',
          authors: [{ name: 'Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡ ØªØ³Øª' }],
          year: 2024,
          type: 'article',
          abstract: 'Ø§ÛŒÙ† ÛŒÚ© Ù…Ù†Ø¨Ø¹ ØªØ³Øª Ø§Ø³Øª',
          tags: ['ØªØ³Øª', 'Ø§Ú©Ø³ØªÙ†Ø´Ù†'],
        };

        try {
          const response = await chrome.runtime.sendMessage({
            action: 'createSource',
            sourceInfo: testSource,
          });

          showResult('sourceResult', response, response.success);
        } catch (error) {
          showResult('sourceResult', { error: error.message }, false);
        }
      }

      function showResult(elementId, data, isSuccess) {
        const element = document.getElementById(elementId);
        element.style.display = 'block';
        element.className = `result ${isSuccess ? 'success' : 'error'}`;
        element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;

        // Add to logs
        addLog(`${elementId}: ${isSuccess ? 'SUCCESS' : 'ERROR'}`, data);
      }

      function addLog(message, data) {
        const logsElement = document.getElementById('logs');
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = document.createElement('div');
        logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}<br><pre>${JSON.stringify(
          data,
          null,
          2
        )}</pre>`;
        logsElement.appendChild(logEntry);
        logsElement.scrollTop = logsElement.scrollHeight;
      }

      function clearLogs() {
        document.getElementById('logs').innerHTML = '';
      }

      // Listen for console messages from background script
      chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
        if (message.type === 'log') {
          addLog('Background Log', message.data);
        }
      });

      // Initial log
      addLog('Test page loaded', { timestamp: new Date().toISOString() });
    </script>
  </body>
</html>
