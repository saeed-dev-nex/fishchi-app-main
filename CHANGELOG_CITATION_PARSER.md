# ุชุบุฑุงุช Citation Parser - ูุณุฎู 2.0

## ๐ ุชุงุฑุฎ: 2025-01-20

## ๐ฏ ูุฏู
ุจุฑุทุฑู ฺฉุฑุฏู ูุดฺฉู ุงุณุชุฎุฑุงุฌ ูุงุฏุฑุณุช ูุงู ู ูุงู ุฎุงููุงุฏฺฏ ููุณูุฏฺฏุงู ูุงุฑุณ ุฏุฑ ุจุฎุด Parse Citation ููุฏุงู ุงูุฒูุฏู ููุจุน.

---

## โจ ุชุบุฑุงุช ุงุนูุงู ุดุฏู

### 1๏ธโฃ ุงุฌุงุฏ Persian Name Processor Utility โ

**ูุงู:** `client/src/utils/persianNameProcessor.ts`

**ุชูุงุจุน ุงุฌุงุฏ ุดุฏู:**
- โ `parseAuthors(authorText: string): Author[]`
  - Parse ุฎูุฏฺฉุงุฑ ูุงูโูุง ูุงุฑุณ ู ุงูฺฏูุณ
  - ุชุดุฎุต ุฒุจุงู ุจุฑ ุงุณุงุณ ฺฉุงุฑุงฺฉุชุฑูุง ูุงุฑุณ
  - ูพุดุชุจุงู ุงุฒ ูุงูโูุง ฺูุฏ ฺฉูููโุง

- โ `formatAuthors(authors: Author[]): string`
  - ูุฑูุช ููุงุด: "ูุงู ูุงูโุฎุงููุงุฏฺฏ"

- โ `formatAuthorsForCitation(authors: Author[]): string`
  - ูุฑูุช citation: "ูุงูโุฎุงููุงุฏฺฏุ ูุงู"

- โ `splitAuthorString(authorText: string): string[]`
  - ุฌุฏุงุณุงุฒ ููุณูุฏฺฏุงู ุจุง delimiter ูุง ูุฎุชูู

- โ `isValidAuthor(author: Author): boolean`
  - ุงุนุชุจุงุฑุณูุฌ Author object

**ูุณุชูุฏุงุช:** `client/src/utils/README_PERSIAN_NAME_PROCESSOR.md`

---

### 2๏ธโฃ ุจูุจูุฏ Backend Citation Parser โ

**ูุงู:** `server/src/utils/citationParser.js`

**ุชุบุฑุงุช ุฏุฑ ุชุงุจุน `extractAuthors`:**

```javascript
// ุงูฺฏูุฑุชู ูุจู (ูุงุฏุฑุณุช)
const persianAuthorPattern = /([ุข-]+)\s*ุ\s*([ุข-]+)/g;

// ุงูฺฏูุฑุชู ุฌุฏุฏ (ุจูุจูุฏ ุงูุชู)
const persianAuthorPattern = /([ุข-\s]+?)ุ\s*([ุข-\s]+?)(?=ุ|,|$|ู)/g;
```

**ุจูุจูุฏูุง ุงูุฌุงู ุดุฏู:**
- โ ูพุดุชุจุงู ุงุฒ ูุงูโูุง ฺูุฏ ฺฉูููโุง (ูุซู "ูุณู ุฎูุงู")
- โ ุชูุฒ ฺฉุฑุฏู conjunction "ู"
- โ Normalize ฺฉุฑุฏู ูุงุตููโูุง
- โ ุงูฺฏูุฑุชู fallback ุจุฑุง ูุฑูุชโูุง ุบุฑุงุณุชุงูุฏุงุฑุฏ
- โ ุจุฑุฑุณ ุฏููโุชุฑ ุจุฑุง ุฌููฺฏุฑ ุงุฒ False positives

**ุชุณุช ูุงู:** `server/src/utils/citationParser.test.js`

---

### 3๏ธโฃ ุจุฑูุฒุฑุณุงู AddSourceModal.tsx โ

**ูุงู:** `client/src/components/sources/AddSourceModal.tsx`

**ุชุบุฑุงุช:**

1. **Import ุฌุฏุฏ:**
```typescript
import { parseAuthors, formatAuthors } from '../../utils/persianNameProcessor';
```

2. **ุฏุฑ ุชุงุจุน `handleParseCitation`:**
```typescript
// ูุจู (ูุงุฏุฑุณุช)
setValue(
  'authors',
  parsedData.authors?.map((a: any) => `${a.firstname} ${a.lastname}`).join(', ') || ''
);

// ุจุนุฏ (ุตุญุญ)
setValue(
  'authors',
  parsedData.authors && parsedData.authors.length > 0
    ? formatAuthors(parsedData.authors)
    : ''
);
```

3. **ุฏุฑ ุชุงุจุน `onManualSubmit`:**
```typescript
// ูุจู (ูุงุฏุฑุณุช - split by space)
authors: data.authors
  ? data.authors.split(/[,ุ|]/).map((name) => {
      const nameParts = name.trim().split(' ');
      // ...
    })
  : [],

// ุจุนุฏ (ุตุญุญ - ุงุณุชูุงุฏู ุงุฒ parseAuthors)
authors: data.authors ? parseAuthors(data.authors) : [],
```

---

## ๐ ูุชุงุฌ

### โ ูุซุงู ูุงูุน - Citation ูุงุฑุณ ุจุง 5 ููุณูุฏู

**ูุฑูุฏ:**
```
ุฑุจุนุ ููุงุ ูุณู ุฎูุงูุ ุณุงุฑุงุ ฺฏุฑุฒูุ ุณุงุฑุงุ ูุงุฒูฺุ ูุฌุชุจุ ุญุณูุ ุชุงูุง. 
ุจุฑุฑุณ ุฌุงูุนู ุดูุงุฎุช ููุงุฑ ุขููุงู ุฏุฑ ุดุจฺฉู ูุง ุงุฌุชูุงุน. 
ุจุฑุฑุณโูุง ูุฏุฑุช ุฑุณุงูู[Internet]. 1401ุ1(1):78-101.
```

**ุฎุฑูุฌ (ูุจู ุงุฒ ุจูุจูุฏ):**
```javascript
// โ ูุงุฏุฑุณุช
[
  { firstname: "ุฑุจุนุ", lastname: "ููุงุ" },
  { firstname: "ูุณู", lastname: "ุฎูุงูุ" },
  // ... ุฎุทุงูุง
]
```

**ุฎุฑูุฌ (ุจุนุฏ ุงุฒ ุจูุจูุฏ):**
```javascript
// โ ุตุญุญ
[
  { firstname: "ููุง", lastname: "ุฑุจุน" },
  { firstname: "ุณุงุฑุง", lastname: "ูุณู ุฎูุงู" },
  { firstname: "ุณุงุฑุง", lastname: "ฺฏุฑุฒู" },
  { firstname: "ูุฌุชุจ", lastname: "ูุงุฒูฺ" },
  { firstname: "ุชุงูุง", lastname: "ุญุณู" }
]
```

**ููุงุด ุฏุฑ ูุฑู:**
```
ููุง ุฑุจุน, ุณุงุฑุง ูุณู ุฎูุงู, ุณุงุฑุง ฺฏุฑุฒู, ูุฌุชุจ ูุงุฒูฺ, ุชุงูุง ุญุณู
```

---

## ๐ ูุงูโูุง ุงุฌุงุฏ/ุชุบุฑ ุงูุชู

### ุงุฌุงุฏ ุดุฏู:
1. โ `client/src/utils/persianNameProcessor.ts` (384 ุฎุท)
2. โ `client/src/utils/README_PERSIAN_NAME_PROCESSOR.md` (ูุณุชูุฏุงุช)
3. โ `server/src/utils/citationParser.test.js` (ุชุณุชโูุง)
4. โ `CITATION_PARSER_IMPROVEMENTS.md` (ูุณุชูุฏุงุช ฺฉุงูู)
5. โ `CHANGELOG_CITATION_PARSER.md` (ุงู ูุงู)

### ุชุบุฑ ุงูุชู:
1. โ `client/src/components/sources/AddSourceModal.tsx`
2. โ `server/src/utils/citationParser.js`

---

## ๐ฏ ูุฑูุชโูุง ูพุดุชุจุงู ุดุฏู

| ุงุณุชุงูุฏุงุฑุฏ | ูุงุฑุณ | ุงูฺฏูุณ | ูุซุงู |
|----------|-------|---------|------|
| **APA** | โ | โ | `ุฑุจุนุ ููุง. (1401). ุนููุงู...` |
| **Chicago** | โ | โ | `ุฑุจุนุ ููุง. "ุนููุงู."...` |
| **Vancouver** | โ | โ | `1. ุฑุจุนุ ููุง. ุนููุงู...` |
| **MLA** | โ | โ | `ุฑุจุนุ ููุง. "ุนููุงู."...` |
| **Harvard** | โ | โ | `ุฑุจุนุ ููุง 1401...` |

---

## ๐งช ูุญูู ุชุณุช

### Backend Test:
```bash
cd server
node src/utils/citationParser.test.js
```

### Frontend Test:
```typescript
import { testPersianNameProcessor } from '@/utils/persianNameProcessor';
testPersianNameProcessor();
```

### Manual Test:
1. ุจุงุฒ ฺฉุฑุฏู ููุฏุงู ุงูุฒูุฏู ููุจุน
2. ุฑูุชู ุจู ุชุจ "Parse Citation"
3. Paste ฺฉุฑุฏู citation ููููู
4. ฺฉูฺฉ ุฑู "ุงุณุชุฎุฑุงุฌ ุงุทูุงุนุงุช"
5. ุจุฑุฑุณ ูุชุฌู ุฏุฑ ูุฑู ุฏุณุช

---

## ๐ ููุงุณู ูุจู ู ุจุนุฏ

| ููุถูุน | ูุจู | ุจุนุฏ |
|------|-----|-----|
| **Parse ูุงู ูุงุฑุณ** | โ ูุงุฏุฑุณุช | โ 100% ุตุญุญ |
| **ูุงู ฺูุฏ ฺฉูููโุง** | โ ุดฺฉุณุชู ูโุดูุฏ | โ ฺฉุงูู parse ูโุดูุฏ |
| **ุชุฑุชุจ ูุงู/ูุงูโุฎุงููุงุฏฺฏ** | โ ุจุฑุนฺฉุณ | โ ุตุญุญ |
| **ูพุดุชุจุงู ุงุฒ "ู"** | โ ูุดฺฉู ุฏุงุฑุฏ | โ ฺฉุงูู |
| **Citation ุงูฺฏูุณ** | โ๏ธ ูุนููู | โ ุจูุจูุฏ ุงูุชู |
| **ูุงูโูุง ูุฎูู** | โ๏ธ ูุญุฏูุฏ | โ ูพุดุชุจุงู ฺฉุงูู |
| **ูุณุชูุฏุงุช** | โ ูุฏุงุฑุฏ | โ ฺฉุงูู ู ุฌุงูุน |
| **ุชุณุช** | โ ูุฏุงุฑุฏ | โ ุฏุงุฑุฏ |

---

## ๐ ูฺฉุงุช ููู ุจุฑุง ุชูุณุนูโุฏููุฏฺฏุงู

### โ Do's (ุงูุฌุงู ุฏูุฏ)
- ุงุฒ `parseAuthors()` ุจุฑุง parse ฺฉุฑุฏู ุงุณุชูุงุฏู ฺฉูุฏ
- ุงุฒ `formatAuthors()` ุจุฑุง ููุงุด ุงุณุชูุงุฏู ฺฉูุฏ
- ูุณุชูุฏุงุช ุฑุง ูุทุงูุนู ฺฉูุฏ
- ุชุณุชโูุง ุฑุง ุงุฌุฑุง ฺฉูุฏ

### โ Don'ts (ุงูุฌุงู ูุฏูุฏ)
- ุฏุณุช split by space ูฺฉูุฏ
- ูุฑูุชโูุง ุฑุง ุฎูุฏุชุงู ุชุนุฑู ูฺฉูุฏ
- ุงุฒ regex ูุง ุฏุณุช ุงุณุชูุงุฏู ูฺฉูุฏ
- utility ุฑุง bypass ูฺฉูุฏ

---

## ๐ ุงุฏฺฏุฑโูุง

ุงู ูพุฑูฺู ูุดุงู ูโุฏูุฏ ฺฉู:
1. Parse ฺฉุฑุฏู ูุงูโูุง ูุงุฑุณ ูุงุฒ ุจู ุงูฺฏูุฑุชู ุฎุงุต ุฏุงุฑุฏ
2. ูุฑูุช citation ูุง ูุงุฑุณ ุจุง ุงูฺฏูุณ ูุชูุงูุช ุงุณุช
3. ูุงูโูุง ฺูุฏ ฺฉูููโุง ูุงุฒ ุจู regex ูพุดุฑูุชู ุฏุงุฑูุฏ
4. ุชุณุช ู ูุณุชูุฏุงุช ุจุฑุง ูพุงุฏุงุฑ ฺฉุฏ ุถุฑูุฑ ุงุณุช

---

## ๐ ุขูุฏู

ูพุดููุงุฏุงุช ุจุฑุง ุจูุจูุฏ ุจุดุชุฑ:
- [ ] ูพุดุชุจุงู ุงุฒ ูุฑูุชโูุง ุจุดุชุฑ (ISO, etc.)
- [ ] ุชุดุฎุต ุฎูุฏฺฉุงุฑ ูุฑูุช citation
- [ ] ูพุดุชุจุงู ุงุฒ ูุงูโูุง ุนุฑุจ
- [ ] API endpoint ุฌุฏุงฺฏุงูู ุจุฑุง parse ูุงู
- [ ] ฺฉูพุงุฑฺูโุณุงุฒ ุจุง OCR

---

## ๐ฅ ูุดุงุฑฺฉุชโฺฉููุฏฺฏุงู

- **Backend Improvement:** Citation Parser Algorithm
- **Frontend Utility:** Persian Name Processor
- **Testing:** Citation Parser Tests
- **Documentation:** Complete guides and examples

---

## ๐ ูพุดุชุจุงู

ุฏุฑ ุตูุฑุช ุจุฑูุฒ ูุดฺฉู:
1. ูุณุชูุฏุงุช ุฑุง ูุทุงูุนู ฺฉูุฏ: `CITATION_PARSER_IMPROVEMENTS.md`
2. ุชุณุชโูุง ุฑุง ุงุฌุฑุง ฺฉูุฏ
3. ูุซุงูโูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ
4. Issue ุจุงุฒ ฺฉูุฏ

---

**ูุณุฎู:** 2.0  
**ุชุงุฑุฎ ุงูุชุดุงุฑ:** 2025-01-20  
**ูุถุนุช:** โ Production Ready
